---
title: "2042 MLM Mini Project (Spring 2020)"
subtitle: "Group 1"
date:  "`r format(Sys.time(), '%B %d %Y')`"
output:
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, tidy = TRUE)
```

```{r dependencies, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
# Dependencies -----------------------------------------------------------------
if(!requireNamespace("here"))
  install.packages("here", repos = "https://cloud.r-project.org")
require("here")

if(!requireNamespace("lme4"))
  install.packages("lme4", repos = "https://cloud.r-project.org")
require("lme4")

if(!requireNamespace("lmerTest"))
  install.packages("lmerTest", repos = "https://cloud.r-project.org")
require("lmerTest")
```

## Team members and division of work

```{r}
# Insert code to set.seed
```

### Question 1

You will generate simulated data for a single school with 100 classrooms, each of which has 200 students. 

  a. Outcome for student $i$ in classroom $j$: $Y_{ij}$.
    
  b. There is a single predictor, $X_{ij} \sim U(0,1)$ (uniform on [0,1])
    
  c. There is a classroom random effect, $\eta_j \sim N(0,\sigma^2_{\eta})$, where $\sigma^2_{\eta} = 2$. 
  
  d. Subject level error, $\varepsilon_{ij} \sim N(0, \sigma^2_{\varepsilon})$, where  $\sigma^2_{\varepsilon} = 2$. 
  
  e. `set.seed(2042001)` once at the beginning of your code.
  
  f. Generate the random quantities in this order to ensure the same solution for everyone: X, $\eta_j$, $\varepsilon_{ij}$ 
  
  g. The outcome has the following form (DGP, given the modeling parameters above):
$$Y_{ij} = 0 + 1X_{ij} + \eta_j + \varepsilon_{ij} ; \mbox{     } \eta_j \sim N(0,\sigma^2_{\eta}), \varepsilon_{ij} \sim N(0, \sigma^2_{\varepsilon}), indep. $$
  h. Generate a single simulated dataset (you will need a "classid" variable to track classrooms); you can optionally assign a "studentid")
  i. **Important:** construct classid such that classrooms appear consecutively within the dataframe. As per: `rep(1:J,each=n_j)`
  
  
```{r}
# Insert code to generate data and outcome variable, store variables in a dataframe
```

  
### Question 2: 
Fit the model corresponding to the DGP on your simulated data.
```{r}
# Insert code to fit model and print summary
```

a. Report coefficient estimate for slope on X.

    Response: 

b. Does a 95% confidence band for this coefficient estimate cover the “truth” that you used to generate the data? **comment**

```{r}
# Insert code to compute confidence interval 
```

    Response:
    
### Question 3:
3. Next, we simulate missing data in several ways. This is the first:
a. Make a copy of the data, then modify the copy following these instructions:
```{r}
# Insert code to make a copy of the data
```

b. Generate $Z_{ij} \sim$ Bernoulli$(p)$, with $p = 0.5$
c. Set Y to NA when $Z_{ij} == 1$. This should look a lot like "MCAR" missingness.
```{r}
# Insert code the generate your data
```

d. Refit the model on the new data and report the coefficient estimate for slope on X. Look at the other parameter estimates as well.
```{r}
# Insert code to fit model and compute confidence interval
```

e. Do you see any real change in the $\beta_X$ estimate? **comment**
    i. Does a 95% confidence band for this coefficient estimate cover the “truth” that you used to generate the data?
    
    Response: 

f. What is the total sample size $N$ used in the model fit? **comment**

    Response:
    
### Question 4: 
Missing Data II: Make another copy of the original data, then modify the copy as follows:
a. Generate $Z_{ij} \sim$ Bernoulli$(X_{ij})$, with $X_{ij}$ your predictor generated previously.
b. Set Y to NA when $Z_{ij} == 1$. This should look a lot like "MAR" missingness.
```{r}
# Insert code the generate your data
```
c. Refit the model on the new data and report the coefficient estimate for slope on X. Look at the other parameter estimates as well. **comment**
```{r}
# Insert code to fit model and compute confidence interval
```

    Response: 

d. Do you see any real change in the $\beta_X$ estimate?
    i. Does a 95% confidence band for this coefficient estimate cover the “truth” that you used to generate the data? **comment**
    
    Response:

e. What is the total sample size $N$ used in the model fit? **comment**

    Response:

### Question 5: 
Missing Data III: Make another copy of the original data, then modify the copy as follows:
```{r}
# Insert code to make a copy of the original data
```

a. First, define the expit function: `expit <- function(x) exp(x)/(1+exp(x))`
```{r}
# Insert code to define expit function
```

b. Generate $Z_{ij} \sim$ Bernoulli$(expit(Y_{ij}))$, with $Y_{ij}$ your *outcome* generated previously. 

c. Set Y to NA when $Z_{ij} == 1$. This should look like a violation of "MAR" missingness (missingness depedents on outcome and cannot be *simply* predicted with the predictor set -- Y should be correlated with X, though, so it might not be too bad a violation). 
```{r}
# Insert code the generate your data
```

d. Refit the model on the new data and report the coefficient estimate for slope on X. Look at the other parameter estimates as well. **comment**
```{r}
# Insert code to fit model and compute confidence interval
```

    Response:

e. Do you see any real change in the $\beta_X$ estimate? **comment**
    i. Does a 95% confidence band for this coefficient estimate cover the “truth” that you used to generate the data? **comment**
    
      Response:
    
f. What is the total sample size $N$ used in the model fit? **comment**

    Response:







